# Tasks: User Media Library

**Input**: Design documents from `/specs/004-user-media-library/`
**Prerequisites**: plan.md, spec.md, data-model.md, contracts/api.md, research.md

**Organization**: –ó–∞–¥–∞—á–∏ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ User Stories –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## Format: `[ID] [P?] [Story] Description`

- **[P]**: –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (—Ä–∞–∑–Ω—ã–µ —Ñ–∞–π–ª—ã, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- **[Story]**: –ö –∫–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∑–∞–¥–∞—á–∞ (US1, US2, US3)
- –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º —É–∫–∞–∑–∞–Ω—ã –≤ –æ–ø–∏—Å–∞–Ω–∏–∏

---

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

- [x] T001 –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL —Å—Ö–µ–º—É –∏–∑ specs/004-user-media-library/contracts/schema.sql (—Ç–∞–±–ª–∏—Ü—ã, —Ç–∏–ø—ã, RLS)
- [x] T002 –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –±–∞–∫–µ—Ç `user-media` –≤ Supabase Storage –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–∑ data-model.md
- [x] T003 [P] –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: app/library/components/ –∏ lib/library/

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: –Ø–¥—Ä–æ –ª–æ–≥–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

- [x] T004 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ö–µ–ª–ø–µ—Ä `saveToLibrary` –≤ lib/library/save-to-library.ts –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Storage –∏ –∑–∞–ø–∏—Å–∏ –≤ –ë–î
- [x] T005 [P] –°–æ–∑–¥–∞—Ç—å TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ lib/library/types.ts

**Checkpoint**: –§—É–Ω–¥–∞–º–µ–Ω—Ç –≥–æ—Ç–æ–≤ ‚Äî –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ User Stories

---

## Phase 3: User Story 1 - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (Priority: P1) üéØ MVP

**Goal**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É

**Independent Test**: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ª—é–±–æ–º –º–æ–¥—É–ª–µ –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ—è–≤–∏–ª–∞—Å—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `library_items` –∏ —Ñ–∞–π–ª –≤ –±–∞–∫–µ—Ç–µ `user-media`.

### Implementation for User Story 1

- [x] T006 [US1] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ app/api/product-enhance/route.ts
- [x] T007 [US1] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ app/api/fashion-motion/route.ts
- [x] T008 [US1] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ app/api/generate/route.ts
- [x] T009 [US1] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ app/api/angles/route.ts

**Checkpoint**: –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. MVP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤.

---

## Phase 4: User Story 2 - –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è (Priority: P1)

**Goal**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ —Ä–∞–±–æ—Ç—ã –≤ –≤–∏–¥–µ —Å–µ—Ç–∫–∏ —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Å–∫—Ä–æ–ª–ª–æ–º

**Independent Test**: –û—Ç–∫—Ä—ã—Ç—å /library –∏ —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö —Ä–∞–±–æ—Ç. –ü—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –≤–Ω–∏–∑ –¥–æ–ª–∂–Ω—ã –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—Ç–∞—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã.

### Implementation for User Story 2

- [x] T010 [US2] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç GET app/api/library/route.ts —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π signed URLs
- [x] T011 [P] [US2] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ app/library/components/LibraryItem.tsx (lazy loading, WebP)
- [x] T012 [US2] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–µ—Ç–∫–∏ app/library/components/LibraryGrid.tsx —Å –ª–æ–≥–∏–∫–æ–π Infinite Scroll (SWR –∏–ª–∏ Intersection Observer)
- [x] T013 [US2] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ app/library/page.tsx

---

## Phase 5: User Story 3 - –î–µ—Ç–∞–ª–∏ –∏ Remix (Priority: P2)

**Goal**: –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç

**Independent Test**: –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–µ—Ç–∫–µ, —É–≤–∏–¥–µ—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∏ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "Use Prompt", –∫–æ—Ç–æ—Ä–∞—è –≤–µ—Ä–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä.

### Implementation for User Story 3

- [x] T014 [US3] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç GET app/api/library/[id]/route.ts –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- [x] T015 [US3] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π app/library/components/ItemModal.tsx
- [x] T016 [US3] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É "Remix" (Use Prompt) ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å query-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

---

## Phase 6: Polish & Cross-Cutting Concerns

**Purpose**: –ù–∞–≤–∏–≥–∞—Ü–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–º –∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞

- [x] T017 [P] –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç "My Library" –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å app/components/Sidebar.tsx
- [x] T018 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç DELETE app/api/library/[id]/route.ts (–∞—Ç–æ–º–∞—Ä–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î –∏ Storage)
- [x] T019 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç DELETE app/api/library/batch/route.ts (—É–¥–∞–ª–µ–Ω–∏–µ –¥–æ 20 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
- [x] T020 [P] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç GET app/api/library/usage/route.ts –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- [x] T021 –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç app/library/components/UsageIndicator.tsx –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ 1GB
- [x] T022 [P] –î–æ–±–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (Empty States) –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- [x] T023 –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ quickstart.md

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: –°—Ä–∞–∑—É.
- **Foundational (Phase 2)**: –ü–æ—Å–ª–µ Setup. –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ US.
- **User Story 1 (Phase 3)**: –ü–æ—Å–ª–µ Foundational. –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ë–î.
- **User Story 2 (Phase 4)**: –ü–æ—Å–ª–µ Foundational. –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö (US1).
- **User Story 3 (Phase 5)**: –ü–æ—Å–ª–µ US2.
- **Polish (Phase 6)**: –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è P1 –∏—Å—Ç–æ—Ä–∏–π.

### Parallel Opportunities

- T003, T005 [P] ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
- T011 [P] ‚Äî –≤–µ—Ä—Å—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–∫–∞ –ø–∏—à–µ—Ç—Å—è API (T010).
- T017, T020, T022 [P] ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏—á–∏.

---

## Parallel Example: Foundational & Setup
```bash
# –ú–æ–∂–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ç–∏–ø—ã
Task: "Create directories in app/library/components/"
Task: "Create TypeScript interfaces in lib/library/types.ts"
```

---

## Implementation Strategy

### MVP First (US1 + US2)
1. Setup DB & Storage.
2. Foundational logic.
3. Integrate saving into generate API.
4. Minimal List UI.
5. **Validate**: –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è.

### Incremental Delivery
1. Foundation -> –ë–∞–∑–∞ –≥–æ—Ç–æ–≤–∞.
2. US1 -> –î–∞–Ω–Ω—ã–µ –Ω–∞—á–∞–ª–∏ –∫–æ–ø–∏—Ç—å—Å—è.
3. US2 -> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–µ–ª –¥–∞–Ω–Ω—ã–µ.
4. US3 -> –ü–æ—è–≤–∏–ª–∞—Å—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (Remix).
5. Polish -> –ù–∞–≤–∏–≥–∞—Ü–∏—è, —É–¥–∞–ª–µ–Ω–∏–µ, –ª–∏–º–∏—Ç—ã.
